<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Lista de Invitados</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f6f6f6;
      padding: 30px;
    }
    h1 {
      text-align: center;
    }
    .filtros {
      text-align: center;
      margin-bottom: 15px;
    }
    select {
      padding: 8px;
      font-size: 14px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
    }
    th, td {
      padding: 10px;
      border-bottom: 1px solid #ddd;
    }
    th {
      background: #222;
      color: white;
    }
    .ok {
      color: green;
      font-weight: bold;
    }
    .no {
      color: red;
      font-weight: bold;
    }
  </style>
</head>
<body>

<h1>ðŸ“‹ Invitados</h1>

<div class="filtros">
  Mostrar:
  <select id="filtroEstado">
    <option value="todos">Todos</option>
    <option value="aceptados">Aceptados</option>
    <option value="no">No aceptados</option>
  </select>
</div>

<table>
  <thead>
    <tr>
      <th>Familia</th>
      <th>Nombre</th>
      <th>Pases</th>
      <th>Estado</th>
      <th>Confirmado</th>
    </tr>
  </thead>
  <tbody id="tabla"></tbody>
</table>

<script>
let invitados = [];

fetch("/.netlify/functions/listar-invitados")
  .then(res => res.json())
  .then(data => {
    if (!data.ok) return;
    invitados = data.invitados;
    renderTabla("todos");
  });

document.getElementById("filtroEstado").addEventListener("change", e => {
  renderTabla(e.target.value);
});

function renderTabla(filtro) {
  const tbody = document.getElementById("tabla");
  tbody.innerHTML = "";

  invitados
    .filter(inv => {
      if (filtro === "aceptados") return inv.acepto;
      if (filtro === "no") return !inv.acepto;
      return true;
    })
    .forEach(inv => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${inv.familia}</td>
        <td>${inv.dipleyname}</td>
        <td>${inv.pases}</td>
        <td class="${inv.acepto ? "ok" : "no"}">
          ${inv.acepto ? "AceptÃ³" : "No aceptÃ³"}
        </td>
        <td>${inv.confirmado_en 
          ? new Date(inv.confirmado_en).toLocaleString() 
          : "-"}</td>
      `;
      tbody.appendChild(tr);
    });
}
</script>

</body>
</html>
